#!/bin/bash

dir=/usr/share/sounds/fruitplayer
aplay -q $dir/1up.wav
count=0
banana=0
rand=$(( ( RANDOM % 25 )  + 15 ))
while true; do
read -s -n1 sound

if [ $sound = a ] ; then
	aplay -q $dir/coin.wav & 
elif [ $sound = s ] ; then
	if [ $banana = $rand ];then
		aplay -q $dir/banana.wav &
		banana=0
		rand=$(( ( RANDOM % 25 )  + 15 ))
	else
		aplay -q $dir/fireball.wav &
		(( banana++ ))
	fi
elif [ $sound = d ] ; then
	aplay -q $dir/jump.wav &
elif [ $sound = f ] ; then
	aplay -q $dir/kick.wav &
elif [ $sound = g ] ; then
	aplay -q $dir/mip.wav &
elif [ $sound = q ] ; then
	exit 0
elif [ $sound = w ] ; then
	aplay -q $dir/enter-stage.wav &
	sleep 1
	sudo shutdown -h now
pattern=" |'"
elif [[ $sound =~ $pattern ]]; then
	ip=$(ip addr|grep "inet "|grep -v 127.0.0.1|awk '{print $2}'|awk -F/ '{print $1}'|grep -v ^$|head -n1)
	if [ $count = 0 ];then
		sudo espeak -ven+f3 -k5 -s100 "$ip" 2>/dev/null
		count=1
		sleep 1 
	fi
else
	count=0	
fi
done
